---
title: 'Project 1: regression 1'
author: "Urvan Christen, Amandine Goffeney, Joseph Vermeil, Lucile ViguÃfÂ©"
date: "March 20, 2019"
output:
  html_document:
    df_print: paged
  pdf_document:
    df_print: paged
fontsize: 12pt
geometry: margin=2.5cm
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[LE,RO]{Christen, Goffeney, Vermeil, ViguÃfÂ©}
df_print: paged
bibliography: bibliography.bib
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load here the libraries and packages you need for the rest of the analysis.
library(tidyverse)
library("MASS")
library(GGally)
library(car) # contains the vif() and leveneTest() functions
library(gridExtra)
library(cowplot)
```

```{r, echo=FALSE, message=FALSE}
# Loading data
DATA_FILE = "fishermen_mercury.csv" # Location of the data csv file
dataset = read.csv(DATA_FILE) # Loading the data
dataset$MeHg <- NULL # We are asked not to use the variable MeHg
dataset$LogTotHg <- log(dataset$TotHg)
dataset$logFishmlwk <- log(dataset$fishmlwk + 1)

#Converting categorical variables into factors
dataset$fisherman <- factor(dataset$fisherman)
dataset$fishpart <- factor(dataset$fishpart)
```




# Introduction

Mercury is a metal present in the environment whose harmful effects on human health are well assessed [@park2012human]. In a study led in 2000 [@al2000factors], scientists collected data on total mercury and methyl mercury levels in the hair of 100 fishermen of Kuwait, aged 16 to 58 years, comparing them to those of a control population of 35 non-fishermen, aged 26 to 35 years. The aim of this report is to analyse the factors influencing the levels of mercury in both populations. For the sake of simplicity, we will only focus on total Hg, leaving out methyl mercury, as both variables are strongly correlated.

The dataset gathers information about six numerical variables (age, height, weight, number of fish meals per week and residence time in Kuwait) and two categorical ones (being a fisherman or not, fish consumption habits). There is no additional information about gender as all the participants in the study are males.

A first insight at the data shows that the fishermen population exhibits higher levels of mercury in their hair. The significance of the difference between the means of both distributions is assessed by a _Welch Two Sample t-test_ with the alternative hypothesis that the fishermen population has a average greater level of mercury than the control population (p-value = 7.473e-05).

```{r, echo=FALSE, message=FALSE, fig.width=4, fig.height=2.5, fig.margin=TRUE}
ggplot(dataset, aes(group=fisherman, y=TotHg, fill=fisherman)) + geom_boxplot() + labs(y = "Total Hg concentration in the hair (mg/g)") + scale_x_discrete() + scale_fill_discrete(name = "Population", labels = c("Control group", "Fishermen")) + theme_bw()
```
```{r, include=FALSE}
t.test(x=dataset[which(dataset$fisherman==1),]$TotHg, y=dataset[which(dataset$fisherman==0),]$TotHg, alternative = "greater", var.equal=FALSE)
```


# Exploratory analysis (Amandine)

#### Overview of the data 
Before fitting a model, let's have a look at the data. The following table shows the 8 conditions of fishmlwk according to the 2 possible conditions of fisherman.
```{r, echo=FALSE, message=FALSE}
table(dataset$fisherman, dataset$fishmlwk)
```
First, let's notice that for some variables, we have a very few people : only 2 people eat fish 3 times a week. We see also that the data are really unbalanced, because the fishermen and non fishermen are separated on the variable "fishmlwk" : the non fishermen don't eat fish more than 2 times a week, whereas the fishermen don't eat fish less than 3 times a week. 
Besides, we face the same unbalanced pattern for the variables "age"" and "restime".

```{r, echo=FALSE, message=FALSE}
par(mfrow=c(1,3))
ggplot(dataset, aes(age, TotHg, colour = fisherman)) + geom_point() #+ scale_y_log10() + scale_x_log10() ##Uncomment for log scales
ggplot(dataset, aes(restime, TotHg, colour = fisherman)) + geom_point()
ggplot(dataset, aes(fishmlwk, TotHg, colour = fisherman)) + geom_boxplot()
#grid.arrange(plot1, plot2, plot3, ncol=3, nrow = 1)
```

#### Multicolinearity 

To check whether we have multicolinear variables, we use the VIF function. If all the variables have a result below 5, we keep them. 

```{r ,echo=FALSE, message=FALSE}
hg.form.full = TotHg~ fisherman + age + restime + height + weight + fishmlwk + fishpart 
#hg.form.full2 = TotHg~ (fisherman + age + restime + height + weight + fishpart)^2
#hg.form.full3 = TotHg~ (fisherman + age + restime + height + weight + fishpart)^3

vif(lm(hg.form.full,data=dataset))
#vif(lm(hg.form.full2,data=dataset))
#vif(lm(hg.form.full3,data=dataset))
```
Indeed, we observe that all the variables have a VIF below 2, so we don't eliminate any variable, yet.

# Model selection (Joseph)

Stepwise selection (inclure * fishermen). (Dire qu'on a vÃ©rifiÃ© avec forward et backward et qu'on a trouvÃ© la mÃªme chose => Ã  coder quand mÃªme !)........Finally maybe not so true!...

```{r, echo=FALSE, message=FALSE}
hg.form.pre_selection=TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fishpart + fisherman:(age + restime + height + weight + fishmlwk + fishpart)
fit <- lm(hg.form.pre_selection,data=dataset)
selection <- stepAIC(fit, direction="both")
selection$anova # display results
```

With stepwise selection, the selected model is : 
TotHg ~ fisherman + weight + fishmlwk + fisherman:weight + fisherman:fishmlwk

Backward selection:

```{r}
hg.form.custom = TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fishpart +  fisherman:(age + restime + height + weight + fishmlwk + fishpart)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete restime:fisherman

hg.form.custom = TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fishpart +  fisherman:(age + height + weight + fishmlwk + fishpart)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete fishpart:fisherman

hg.form.custom = TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fishpart +  fisherman:(age + height + weight + fishmlwk)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete height:fisherman

hg.form.custom = TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fishpart +  fisherman:(age + weight + fishmlwk)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete age:fisherman

hg.form.custom = TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fishpart +  fisherman:(weight + fishmlwk)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete fishpart

hg.form.custom = TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fisherman:(weight + fishmlwk)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete height

hg.form.custom = TotHg ~ fisherman + age + restime + weight + fishmlwk + fisherman:(weight + fishmlwk)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete age

hg.form.custom = TotHg ~ fisherman + restime + weight + fishmlwk + fisherman:(weight + fishmlwk)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete restime

hg.form.custom = TotHg ~ fisherman + weight + fishmlwk + fisherman:(weight + fishmlwk)
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete fisherman:weight 

hg.form.custom = TotHg ~ fisherman + weight + fishmlwk + fisherman:fishmlwk
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete fisherman:fishmlwk 

hg.form.custom = TotHg ~ fisherman + weight + fishmlwk
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete fisherman 

hg.form.custom = TotHg ~ weight + fishmlwk
drop1(lm(hg.form.custom, data = dataset), test="F")
#>delete fisherman 
```
With the backward selection we loose all the interaction terms ...

# Results and discussion (Urvan)

Fit model (* fishermen) (I picked the model given by stepwise selection)

```{r, echo=FALSE, message=FALSE}
hg.form.selected=TotHg ~  - 1 + fisherman + fisherman:(weight + fishmlwk)
hg.lm.selected.model=lm(hg.form.selected, data=dataset)
hg.lm.selected.summary <- summary(hg.lm.selected.model)
summary(hg.lm.selected.model)
```


This regression shows several intersting results:

First, we get two coefficients very significantly different from 0 (_p_ < 0.001), both concerning fisherman population. The fact that there are less significant coefficients for non-fisherman population could be explained by several causes:

- The non-fisherman population could be too small to properly show the size effect of those observables.
 
- The non-fisherman population may not have settled long enough in the place to have repercussion on the mercury levels.

However, those are only suppositions in order to explain the distribution of the _p_-values, but none of them have been proven.

On the other side, the number of meal composed of fish (_fishmlwk_) seems to be contributing to the mercury levels of both populations (_p_-values of `r format(hg.lm.selected.summary[["coefficients"]][5,4], digits=1)` for non-fisherman and `r format(hg.lm.selected.summary[["coefficients"]][6,4], digits=1)` for fisherman). However, we can see that there is a huge difference between the two contributions of a factor `r format(hg.lm.selected.summary[["coefficients"]][5,1]/hg.lm.selected.summary[["coefficients"]][6,1], digits=1)`.

However, the most significant coefficient is for _weight_ for fisherman populatio, with a _p_-value of `r format(hg.lm.selected.summary[["coefficients"]][4,4], digits=1, scientific=TRUE)`. 

```{r, echo=FALSE, message=FALSE}
library(ggplot2)
plot(hg.lm.selected.model, which=1) #residuals vs fitted
qplot(hg.lm.selected.model$fitted.values, hg.lm.selected.model$residuals, colour=dataset$fisherman, xlab = "fitted values", ylab = "residuals") + labs(colour = 'fisherman')
plot(hg.lm.selected.model, which=2) #QQ plot
plot(hg.lm.selected.model, which=3) #scale location
plot(hg.lm.selected.model, which=4) #cook's distance
plot(hg.lm.selected.model, which=5) #residuals vs leverage 
plot(hg.lm.selected.model, which=6) #cook's distance vs leverage
```


# Conclusion (Lucile)

3 lignes

Les principales variables explicatives sont:

- La consommation de poisson => logique
- Le poids => plus Ã©tonnant mais on sait que les cellules graisseuses stockent les toxiques

# References