---
title: 'Factors influencing the levels of mercury in the hair of fishermen and non-fishermen'
author: "Urvan Christen, Amandine Goffeney, Joseph Vermeil, Lucile Vigué"
output:
  pdf_document:
    df_print: paged
    keep_tex: yes
  html_document:
    df_print: paged
geometry: margin=2.5cm
header-includes:
- \usepackage{fancyhdr}
- \usepackage{wrapfig}
- \pagestyle{fancy}
- \fancyhead[LE,RO]{Christen, Goffeney, Vermeil, Vigué}
fontsize: 12pt
bibliography: bibliography.bib
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load here the libraries and packages you need for the rest of the analysis.
library(tidyverse)
library("MASS")
library(GGally)
library(car) # contains the vif() and leveneTest() functions
library(gridExtra)
library(cowplot)
library(knitr)
library(kableExtra)
library(plyr)
```

```{r, echo=FALSE, message=FALSE}
# Loading data
DATA_FILE = "fishermen_mercury.csv" # Location of the data csv file
dataset = read.csv(DATA_FILE) # Loading the data
dataset$MeHg <- NULL # We are asked not to use the variable MeHg

dataset.unfactored = read.csv(DATA_FILE) # Loading the data
dataset.unfactored$MeHg <- NULL # We are asked not to use the variable MeHg

#Converting categorical variables into factors
#dataset$fisherman <- factor(dataset$fisherman)
dataset$fishpart <- factor(dataset$fishpart)
```

```{r, include = F}
defOut <- knitr::knit_hooks$get("plot")  # save the default plot hook 
knitr::knit_hooks$set(plot = function(x, options) {  # set new plot hook ...
  x <- defOut(x, options)  # first apply the default hook
  if(!is.null(options$wrapfigure)) {  # then, if option wrapfigure is given ...
    # create the new opening string for the wrapfigure environment ...
    wf <- sprintf("\\begin{wrapfigure}{%s}{%g\\textwidth}", options$wrapfigure[[1]], options$wrapfigure[[2]])
    x  <- gsub("\\begin{figure}", wf, x, fixed = T)  # and replace the default one with it.
    x  <- gsub("{figure}", "{wrapfigure}", x, fixed = T)  # also replace the environment ending
  }
  return(x)
})
```


## Introduction

Mercury is a metal present in the environment whose harmful effects on human health are well known [@park2012human]. In [@al2000factors], total mercury and methyl mercury levels in the hair of 100 fishermen of Kuwait, aged 16 to 58 years, were compared to those of a control population of 35 non-fishermen, aged 26 to 35 years. The aim of our study is to analyse the factors influencing the levels of mercury in both populations. For the sake of simplicity, we will only focus on total Hg, leaving out methyl mercury, since both variables are strongly correlated (shown in the paper). The dataset contains six numerical variables (age, height, weight, number of fish meals per week and residence time in Kuwait) and two categorical variables (being a fisherman or not, fish consumption habits). All study participants are male.


```{r, include=FALSE}
t.test(x=dataset[which(dataset$fisherman==1),]$TotHg, y=dataset[which(dataset$fisherman==0),]$TotHg, alternative = "greater", var.equal=FALSE)
```

```{r, include=FALSE, echo = F, warning = F, message = F, fig.width=3.5, fig.height = 3, fig.cap = "\\label{fig:boxplots}Boxplots of Hg levels", fig.align="right", wrapfigure = list("R", .35)}
#, out.width = ".7\\textwidth"
ggplot(dataset, aes(group=as.factor(fisherman), y=TotHg, fill=as.factor(fisherman))) + geom_boxplot() + labs(y = "Total Hg concentration in the hair (mg/g)") + scale_x_discrete() + scale_fill_discrete(name = "Population", labels = c("Control group", "Fishermen")) + theme_bw()
```

## Exploratory analysis

Before fitting a model, we first look at the data. Table \ref{tbl:fishmlwk} shows the distribution of individuals according to the number of fish meals per week and the two groups. We note that for some values, there are very few people. For instance only two people eat fish three times per week. We also see that the number of fish meals per week is completely separable by population group. This explains the strong correlation observed between these two variables in the correlation matrix (Table \ref{tbl:correlation}). Besides, we also observe that the variables age and residence time in Kuwait are quite correlated with being a fisherman or not. To check whether we have multicolinear variables, we use the variance inflation factor (VIF). We set the following criteria: we keep only the variables that have a result below 5. We observe that all the variables have a variance inflation factor below 2, so we do not eliminate any variable, for the moment.


```{r, echo=FALSE, message=FALSE, result='asis'}
data.table = table(dataset$fisherman, dataset$fishmlwk)
row.names(data.table) <- c("non-fisherman", "fisherman")
kable(data.table, format = "latex", booktabs = T, caption = "\\label{tbl:fishmlwk}Distribution of the number of fish meals accross fishermen and non-fishermen populations") %>% 
  kable_styling(latex_options = "striped")
```

```{r, echo=FALSE, results='asis'}
  kable(cor(dataset.unfactored), format = "latex", digits = 2, caption = "\\label{tbl:correlation}Correlation matrix")%>% 
  kable_styling(latex_options = "striped")
```

```{r, fig.width=5, fig.height = 4, fig.cap = "\\label{fig:pair_plots}Pair plots", echo=F}
plot(dataset)
```




```{r, echo=FALSE, message=FALSE, include=FALSE}
par(mfrow=c(1,3))
ggplot(dataset, aes(age, TotHg, colour = fisherman)) + geom_point() #+ scale_y_log10() + scale_x_log10() ##Uncomment for log scales
ggplot(dataset, aes(restime, TotHg, colour = fisherman)) + geom_point()
ggplot(dataset, aes(fishmlwk, TotHg, colour = fisherman)) + geom_boxplot()
#grid.arrange(plot1, plot2, plot3, ncol=3, nrow = 1)
```



```{r ,echo=FALSE, message=FALSE, include=FALSE}
hg.form.full = TotHg~ fisherman + age + restime + height + weight + fishmlwk + fishpart 
#hg.form.full2 = TotHg~ (fisherman + age + restime + height + weight + fishpart)^2
#hg.form.full3 = TotHg~ (fisherman + age + restime + height + weight + fishpart)^3

vif(lm(hg.form.full,data=dataset))
#vif(lm(hg.form.full2,data=dataset))
#vif(lm(hg.form.full3,data=dataset))
```




## Model selection


We now use the different methods of model selection to select the more relevant variables to explain the _TotHg_ variations within the population. We first apply a stepwise selection based on a formula with all the variables. With stepwise selection, the selected model is : \(TotHg = \beta_0 + \beta_1 \cdot fisherman  + \beta_2 \cdot age + \beta_3 \cdot restime + \beta_4 \cdot weight + \beta_5 \cdot fishmlwk\). The intercept and the two coefficients are highly significant. Moreover the signs of the coefficients are not absurd: while it is not really intuitive that the weight coefficient should be positive or negative, the coefficient of _fishmlwk_ has to be positive, and it is the case here. Now, to determine possible differences between the fishermen and non-fishermen, a model based on the interactions between the _fisherman_ variable and all the others is proposed. The best model is now \(TotHg = \beta_0 + \beta_1 \cdot fisherman + \beta_2 \cdot fisherman \cdot weight + \beta_3 \cdot fisherman \cdot fishmlwk\). The coefficients for _fisherman_, _fisherman:weight_ and the intercept are very significant. On the contrary, _fisherman:fishmlwk_ is barely significant, this may be due to the fact that both variables are highly correlated as explained before.

TOUT LE PARAGRAPHE QUI SUIT NE FAIT PLUS SENS MANTENANT
Moreover, when looking at the values of the coefficients, it appears that for the non-fishermen, the number of fish meal per week has a very preponderant effect compared to the weight influence, while among fishermen, the contribution of _weight_ is twice the one of _fishmlwk_. Eventually the value of \(\beta_1\) (corresponding to _fisherman1_ variable) is surprising: it implies that the fact of being a fisherman gives you -8.99 mg/g Hg compared to non-fishermen. Yet this comes from the increased value of fisherman1:weight, which will make the overall Hg concentration more important among fishermen, as expected. In order to check the dependency of the selected model to the selection technique, we have applied backward and forward selection and obtained similar models.

```{r, echo=FALSE, message=FALSE, include=FALSE}
hg.form.step1 = TotHg ~ fisherman + age + restime + height + weight + fishmlwk + fishpart
model1 <- stepAIC(lm(hg.form.step1,data=dataset), direction="both")
```
```{r, echo=FALSE, message=FALSE}
tbl <- summary(model1)$coefficients
n <- nrow(tbl)
tbl.formatted <- as.matrix(tbl)

# Formatting each column
tbl.formatted[1:n, 1:3] <- format(tbl[1:n, 1:3], digits = 1)
tbl.formatted[1:n, 4] <- format(tbl[1:n, 4], digits = 2, scientific = T)
kable(tbl.formatted, caption = "Full model regression results") %>%
  kable_styling(latex_options = "striped")
```



```{r, echo=FALSE, message=FALSE, include=FALSE}
hg.form.step2 = TotHg ~ fisherman + fisherman:(age + restime + height + weight + fishmlwk + fishpart)
model2 <- stepAIC(lm(hg.form.step2,data=dataset), direction="both")
```
```{r, echo=FALSE, message=FALSE}
tbl <- summary(model2)$coefficients
n <- nrow(tbl)
tbl.formatted <- as.matrix(tbl)

# Formatting each column
tbl.formatted[1:n, 1:3] <- format(tbl[1:n, 1:3], digits = 1)
tbl.formatted[1:n, 4] <- format(tbl[1:n, 4], digits = 2, scientific = T)
kable(tbl.formatted, caption = "Model regression results") %>%
  kable_styling(latex_options = "striped")
```




```{r include=FALSE}
hg.form.bwd = TotHg ~ fisherman + fisherman:(age + restime + height + weight + fishmlwk + fishpart) - 1
drop1(lm(hg.form.bwd, data = dataset), test="F")
#> Delete fisherman:fishpart

hg.form.bwd = TotHg ~ fisherman + fisherman:(age + restime + height + weight + fishmlwk) - 1
drop1(lm(hg.form.bwd, data = dataset), test="F")
#> Delete fisherman:age

hg.form.bwd = TotHg ~ fisherman + fisherman:(restime + height + weight + fishmlwk) - 1
drop1(lm(hg.form.bwd, data = dataset), test="F")
#> Delete fisherman:restime

hg.form.bwd = TotHg ~ fisherman + fisherman:(height + weight + fishmlwk) - 1
drop1(lm(hg.form.bwd, data = dataset), test="F")
#> Delete fisherman:height

hg.form.bwd = TotHg ~ fisherman + fisherman:(weight + fishmlwk) - 1 
drop1(lm(hg.form.bwd, data = dataset), test="F")
#> All parameters are significant (p-value < 0.05)
```


```{r include=FALSE}
hg.form.fwd = TotHg ~ fisherman - 1
add1(lm(hg.form.fwd, data=dataset), test="F", scope = ~ fisherman + fisherman:(age + restime + height + weight + fishmlwk + fishpart) - 1)
#> Add fisherman:weight

hg.form.fwd = TotHg ~ fisherman + fisherman:weight - 1
add1(lm(hg.form.fwd, data=dataset), test="F", scope = ~ fisherman + fisherman:(age + restime + height + weight + fishmlwk + fishpart) - 1)
#> Add fisherman:fishmlwk

hg.form.fwd = TotHg ~ fisherman + fisherman:weight + fisherman:fishmlwk - 1
add1(lm(hg.form.fwd, data=dataset), test="F", scope = ~ fisherman + fisherman:(age + restime + height + weight + fishmlwk + fishpart) - 1)
#> No more significant (p-value < 0.05) parameter to add
```


## Results and discussion

```{r, echo=FALSE, message=FALSE, include=FALSE}
hg.form.selected=TotHg ~  fisherman + fisherman:(weight + fishmlwk)
hg.lm.selected.model=lm(hg.form.selected, data=dataset)
hg.lm.selected.summary <- summary(hg.lm.selected.model)
hg.lm.selected.summary$coefficients
```


We now turn to discussing the results of the model: \(\beta_0 + \beta_1 \cdot fisherman + \beta_2 \cdot fisherman \cdot weight + \beta_3 \cdot fisherman \cdot fishmlwk\).

### Difference between fisherman and control populations

First, we get two coefficients very significantly different from 0 (_p_ < 0.001), both concerning fisherman population. The fact that there are less significant coefficients for non-fisherman population could be explained by several causes:

- The non-fisherman population could be too small to properly show the size effect of those observables.
- The non-fisherman population may not have settled long enough in the place to have repercussion on the mercury levels.

However, those are only suppositions in order to explain the distribution of the _p_-values, but none of them have been proven. Further experiments are needed in order to show whether or not those observables have a really different effect on both populations.

### Number of fish meals per week
TOUTE CETTE PARTIE DOIT ETRE REVUE
On the other side, the number of meals composed of fish (_fishmlwk_) seems to be contributing to the mercury levels of both populations (_p_-values of XXXXXXX for non-fisherman and XXXXXX for fisherman). However, we can see that there is a huge difference between the two contributions of a factor XXXXX.

Here again, we can come up with some possible explanations, needing further inquiries:

- The distribution of _fishmlwk_ is very different between both populations and thus may lead to different coefficients if the effect of this observables is not truly linear (*e.g.* a logarithmic effect that could take some ceiling effects into account, *i.e.* the fact that past a certain dose, the hair cannot absorb more mercury).

- The observable does not reflect entirely the quantity of fish eaten, since one can eat more or less fish per meal. The weight of fish eaten per week, might be a more accurate observable to study.

Here again, more experiments are required to confirm or reject those hypotheses.


### Weight

However, the most significant coefficient is for _weight_ for fisherman population, with a _p_-value of `r format(hg.lm.selected.summary[["coefficients"]][4,4], digits=1, scientific=TRUE)`. This coefficient suggests a high positive correlation between the weight of the fisherman and the concentration of mercury in its hair. 

The fact that the weight has a positive influence on this concentration was unexpected, since a concentration and not an absolute quantity was measured. 

However, even though it was unexpected it has many possible explanations such as the fact that weight is much likely correlated with adiposity more susceptible to catch toxins than other tissues. Another explanation could be that the fatter, the more one eats and possibly ingests mercury that could fix in the hair; since hair weight isn't likely to be correlated with body weight, it could explain the high mercury concentration in hair. 

Here again, further experiments are needed in order to support or reject those hypotheses.

### Diagnostic plots

```{r echo = F, warning = F, message = F, fig.width=3.5, fig.height = 3, fig.cap = "Diagnostic plots", wrapfigure = list("R", .4)}
library(ggplot2)
# plot(hg.lm.selected.model, which=1) #residuals vs fitted
qplot(hg.lm.selected.model$fitted.values, hg.lm.selected.model$residuals, colour=revalue(as.factor(dataset$fisherman), c("0"="non-fisherman", "1"="fisherman")), xlab = "fitted values", ylab = "residuals") + 
  labs(colour = '') +
  theme(legend.position="bottom")
plot(hg.lm.selected.model, which=2, xlab = "Theoretical quantiles")#QQ plot
```

The model does not seem to be really homoscedastic. Variance is much higher for fishermen than for non-fishermen. However, within each class, the variance is overall well distributed, even if it tends to be a little more spread for high fitted values. 


We have a heavy tailed distribution of residuals, with a very heavy right tail. It could be explained by a non-linear relation between the variables and the concentration of mercury. 


## Conclusion

We have built a simple model that can help to explain the levels of mercury observed in a fishermen population compared to a control group. It appears that the variables that have the most significant influence over the measured levels of mercury are the weight of the individual and the frequency at which they eat fish. The former can seem surprising even though some hypotheses can be formed to account for the influence of weight on mercury levels. The latter may be the main explanation for the differences observed between our two groups: fishermen eat fish much more often than non-fishermen, since fish is a well-known source of mercury it seems logical to see a positive correlation between fish meal frequency and mercury levels and thus to observe higher mercury levels in fishermen populations compared to non-fishermen.

## References